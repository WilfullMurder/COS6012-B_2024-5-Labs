# Recipe 06: Creating and Running a Daemon Thread
## Overview
Java features a unique type of thread known as a daemon thread. 
When only daemon threads remain active in a program, the JVM terminates the program once these threads complete their execution. 
Daemon threads are typically utilized to provide services to user threads within the same application. 
They often run in an infinite loop, either waiting for service requests or performing specific tasks. 
A common example of a daemon thread is the Java garbage collector.

In this recipe, we will develop an example with two threads: 
- a user thread that writes events to a queue,
- and a daemon thread that cleans the queue by removing events that were generated more than 10 seconds ago. 
 
The following sections will provide detailed information on the implementation and usage of this example.

## Files

- `Event.java`: A class that stores information about the events.
- `WriterTask.java`: A thread class that writes events to a queue.
- `CleanerTask.java`: A daemon thread class that cleans the queue.
- `Main.java`: The main class that creates and starts a daemon thread.

## How it works
1. **Event.java:**
    - Stores information about the events with two attributes: `date` (of type `java.util.Date`) and `event` (of type `String`).
    - Provides a constructor and accessor methods for the fields.
2. **WriterTask.java:**
    - Implements the `Runnable` interface.
    - The run() method has a loop with 100 iterations. In each iteration, it creates a new event, saves it in the queue, and sleeps for 1 second.

3. **CleanerTask.java:**
    - Extends the `Thread` class.
    - In the constructor, marks this thread as a daemon thread with the setDaemon(true) method.
    - The run() method has an infinite loop that gets the current date and calls the clean() method.
    - The clean() method removes events that were created more than 10 seconds ago and prints the event message and the new size of the queue.
4. **Main.java:**
    - Creates a queue to store the events using the Deque class.
    - Creates and starts as many WriterTask threads as there are available processors.
    - Creates and starts one CleanerTask thread.

## Why it works
Daemon threads run in the background and do not prevent the JVM from exiting when the main thread completes. 
The setDaemon(true) method marks a thread as a daemon thread, 
and the isDaemon() method checks whether a thread is a daemon thread. 
The join() method allows one thread to wait for the completion of another, 
ensuring that the main thread waits for both the WriterTask and CleanerTask threads to finish their execution before proceeding.

## Usage
To run the program, execute the Main class. 
The program will start multiple WriterTask threads that write events to a queue and one CleanerTask thread that cleans the queue. 
The size of the queue will vary around the number of events generated by the WriterTask threads.


## Notes
- The program may not terminate immediately after the main thread completes, as the `CleanerTask` thread is a daemon thread.
- You only can call the `setDaemon()` method before you call the `start()` method. Once the
  thread is running, you can't modify its daemon status calling the `setDaemon()` method. If
  you call it, you will get an `IllegalThreadStateException` exception.
- For more information on thread management and synchronization, refer to "Java Concurrency in Practice" by Brian Goetz and "Effective Java" by Joshua Bloch.